{% extends "base.html" %} {% block title%}Pins - Social Sphere{% endblock %}
{%block content %}

<div class="container">
  <div id="pinList">
    <template id="pinTemplate">
      <button class="pin">
        <div class="info">
          <div class="title"></div>
          <div class="description"></div>
        </div>
        <div class="distance"></div>
      </button>
    </template>
  </div>
</div>

<script>
  async function run(latitude, longitude) {
    let userLocation = L.latLng(latitude, longitude);

    let fetchedPins = await (await fetch("/getPins")).json();

    fetchedPins.forEach((pin) => {
      let clone = document
        .getElementById("pinTemplate")
        .content.cloneNode(true);
      clone.querySelector(".title").innerHTML = pin.title;
      clone.querySelector(".description").innerHTML = pin.description;
      clone.querySelector(".distance").innerHTML =
        userLocation
          .distanceTo(L.latLng(pin.latitude, pin.longitude))
          .toFixed(0) / 1000;
      let button = clone.querySelector(".pin");
      button.id = "pin-" + pin.id;
      button.addEventListener("click", function () {
        window.location.href = `?pinSelected=${pin.id}`;
      });
      document.getElementById("pinList").appendChild(clone);
    });
  }

  // Start
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function (position) {
      run(position.coords.latitude, position.coords.longitude);
    });
  } else {
    run(50.376289, -4.143841);
  }
</script>

<style>
  #pinList {
    width: 100%;
    padding: 10px;
  }
  .pin {
    width: 100%;
    background-color: rgb(30, 9, 90);
    border-radius: 10px;
    height: 80px;
    margin-bottom: 10px;
    padding: 10px;
    border: none;
    text-align: left;
  }

  .pin:hover {
    background-color: rgb(22, 6, 66);
  }

  .info {
    width: 75%;
    height: 100%;
  }

  .title {
    height: 50%;
    color: white;
  }

  .description {
    height: 50%;
    color: white;
  }

  .distance {
    width: 25%;
    height: 100%;
  }
</style>
{% endblock %}
